---
title: 'session1'
author: "Kevin Wang and Garth Tarr"
date: "05/11/2019"
output: html_document
---

# Learning outcomes of this session

+ Understand basic variable types in `R`, in particular the `data.frame`
+ Loading in an Excel sheet as data. 
+ Cleaning columns names 
+ Selection of `data.frame` columns
+ Renaming `data.frame` columns
+ Creating new `data.frame` columns
+ Looking for missing values in `data.frame`
+ Filtering `data.frame` rows
+ Summaring a `data.frame`
+ Saving `data.frame` for next stage of analysis


# Going through some variable types

```{r}
class(c(TRUE, FALSE))
class(1:5)
class(rnorm(5))
class(c("a", "b"))
class(iris)
```



# Loading packages 
```{r}
library(tidyverse)
library(janitor)
library(readxl)
library(visdat)
```


# Loading data


## First attempt

This is bad.

```{r}
raw_data = readxl::read_xls("data/sample_data.xls")

head(raw_data)
```

## Second attempt

This is good. 

```{r}
raw_data = readxl::read_xls("data/sample_data.xls", skip = 3)
head(raw_data)
```


# Cleaning column names

This looks nice. 

```{r}
clean_col_data = raw_data %>% 
  janitor::clean_names()
```


# Selecting data


## Selecting certain columns

This selects columns.

```{r}
sub_data = clean_col_data %>% 
  dplyr::select(strain, sample)

sub_data
```


# Selecting columns by character vector

This selects 4 columns that we will use for our analysis.

```{r}
colnames(clean_col_data) %>% tolower()
select_columns = colnames(clean_col_data)[1:4]
select_columns

sub_data = clean_col_data %>% 
  dplyr::select(one_of(select_columns))

sub_data
```


# Renaming columns


```{r}
sub_data = sub_data %>% 
  dplyr::rename(
    time = time_hours,
    dose = dose_Âµg_kg)
```

# Mutating columns

```{r}
mutate_data = sub_data %>% 
  dplyr::mutate(time = as.numeric(time), 
                dose = as.numeric(dose))
```


# Missing values 
```{r}
mutate_data %>% 
  visdat::vis_miss()
```

# Filtering out problematic rows

```{r}
mutate_data %>% 
  dplyr::filter(is.na(time))

filter_data = mutate_data %>% 
  dplyr::filter(!is.na(time))

filter_data = mutate_data %>% 
  dplyr::filter(complete.cases(time))

filter_data
```


# Making summary statistics 

## Counting number of samples
```{r}
filter_data %>% 
  group_by(strain) %>% 
  count()

filter_data %>% 
  group_by(strain) %>% 
  summarise(n())
```

## Counting with more variables
```{r}
filter_data %>% 
  group_by(strain, dose) %>% 
  count()

filter_data %>% 
  group_by(strain, dose, time) %>% 
  count()
```



# Saving data

```{r}
write_csv(filter_data, path = "data/clean_sample_data.csv")
```


# Session Info 
```{r}
sessionInfo()
```

