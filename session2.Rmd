---
title: "session2"
author: "Kevin Wang and Garth Tarr"
date: "05/11/2019"
output: html_document
---


# Learning outcomes of this session

+ left_join data
+ Making basic plots using `ggplot2`: tile plot and scatter plots
+ Joining two datasets together (`left_join`)
+ `pivot_longer` and `pivot_wider` to reshape data for plotting purposes



# Loading packages

```{r}
library(tidyverse)
```


# Loading cleaned sample data

```{r}
session1_data = read_csv(file = "data/clean_sample_data.csv")
```

# Reading in gene expression data (top 10 rows)
```{r}
raw_ge_data = read_delim(file = "data/GSE43251_NanoString_non-normalized.txt", delim = "\t", n_max = 6)
# raw_ge_data = read_tsv(file = "data/GSE43251_NanoString_non-normalized.txt", n_max = 5)

clean_ge_data = raw_ge_data %>% 
  dplyr::select(-1)

clean_ge_data
```




# left_join sample data
```{r}
ge_sample_data = data.frame(
  sample = colnames(clean_ge_data)[-1],
  ge_data_available = "yes"
)

joined_sample_data = left_join(session1_data, ge_sample_data, by = "sample")

joined_sample_data
```


# DT

```{r}
joined_sample_data %>% 
  DT::datatable()
```



# `tidyr::pivot_longer` the gene expression data

```{r}
ge_data_long = clean_ge_data %>% 
  tidyr::pivot_longer(
    cols = -GENE_SYMBOL,
    names_to = "sample", 
    values_to = "gene_expression")

ge_data_long
```


```{r}
long_sample_ge_data = session1_data %>% 
  left_join(ge_data_long, by = "sample") %>% 
  dplyr::filter(!is.na(GENE_SYMBOL)) %>% 
  janitor::clean_names()


long_sample_ge_data
```


# `ggplot2` visualisation 


```{r}
long_sample_ge_data %>% 
  ggplot()


long_sample_ge_data %>% 
  ggplot(aes(x = strain, 
             y = gene_expression))

long_sample_ge_data %>% 
  ggplot(aes(x = strain, 
             y = gene_expression)) + 
  geom_point()


long_sample_ge_data %>% 
  ggplot(aes(x = strain, 
             y = gene_expression)) + 
  geom_point() +
  facet_wrap(~gene_symbol)



long_sample_ge_data %>% 
  ggplot(aes(x = strain, 
             y = gene_expression)) + 
  geom_point() +
  facet_wrap(~gene_symbol) +
  scale_y_log10()


long_sample_ge_data %>% 
  ggplot(aes(x = strain, 
             y = gene_expression)) + 
  geom_point() +
  geom_boxplot() +
  facet_wrap(~gene_symbol) +
  scale_y_log10()



long_sample_ge_data %>% 
  ggplot(aes(x = strain, 
             y = gene_expression)) + 
  geom_point() +
  geom_boxplot() +
  facet_wrap(~gene_symbol) +
  scale_y_log10(labels = scales::comma)
```


# `tidyr::pivot_wider` the gene expression data

```{r}
wide_sample_ge_data = long_sample_ge_data %>% 
  tidyr::pivot_wider(names_from = "gene_symbol",
                     values_from = "gene_expression")
```

## Visualisation
```{r}
wide_sample_ge_data %>% 
  ggplot(aes(x = Ahrr,
             y = Cxcr7,
             colour = strain)) +
  geom_point() +
  scale_x_log10(labels = scales::comma) +
  scale_y_log10(labels = scales::comma) +
geom_smooth(method = "lm")
```


```{r}
write_csv(long_sample_ge_data, path = "data/long_sample_ge_data.csv")
write_csv(wide_sample_ge_data, path = "data/wide_sample_ge_data.csv")
```




# Session Info
```{r}
sessionInfo()
```

